async function copyToClipboard(e){try{if(navigator.clipboard&&window.isSecureContext)return await navigator.clipboard.writeText(e),!0;const t=document.createElement("textarea");t.value=e,t.style.position="fixed",t.style.left="-999999px",document.body.appendChild(t),t.select();const n=document.execCommand("copy");return document.body.removeChild(t),n}catch(e){return console.error("复制失败:",e),!1}}function showToast(e,t=2e3){const n=document.getElementById("toast");n.classList.remove("show"),n.textContent=e,void n.offsetWidth,n.classList.add("show"),setTimeout(()=>{n.classList.remove("show")},t)}async function copyAndRedirect(e){const t=e.closest(".coupon-card"),n=t.dataset.code,s=t.dataset.url;if(e.disabled)return;e.disabled=!0;const o=await copyToClipboard(n);if(o){const t=e.textContent;e.textContent="已复制!",e.classList.add("copied"),showToast(`优惠码 ${n} 已复制到剪贴板`),setTimeout(()=>{window.open(s,"_blank"),e.textContent=t,e.classList.remove("copied"),e.disabled=!1},1e3)}else showToast("复制失败，请手动复制优惠码"),e.disabled=!1}